---
title: "Using Regression and Classification Techniques on Chicago Crime Dataset"
output:
  pdf_document: default
  html_document: default
date: "2023-01-09"
---

```{r}
theme_set(theme_minimal())
source("chicri/R/utils.R")

```
# Introduction

## Package Description


# Exploratory Data Analysis
Our data can be loaded using the `load_crimes_API()` function from the `chicri` package:
```{r, eval=FALSE}
df <- load_crimes_API(year = NULL)
```

```{r, include = FALSE}
library(tidyverse)
df<- read_csv("~/Desktop/project/data_API.csv", show_col_types = FALSE)
df <- df %>% long_variables()
```

## Variables to Keep

# Predicting Crimes Spatially and Temporally 
For this task we implement a general additive model (GAM) using the `gam()` function from the `mgcv` package.

## Weekly and Monthly Predictions

We use the `count_cases()` function to obtain weekly and monthly counts
```{r}
library(tidyverse)
library(lubridate)
week_count <- df %>% count_cases(date_level = "week", date_end = as.Date("2019-12-31"))

ggplot(data =week_count) +
  geom_point(aes(x= `Week Start`, y = Count), color = "steelblue3", alpha = 0.5)
```
We can see that there is a drop in early 2020 (likely due to the COVID pandemic), and so we only consider data from 2019 or earlier when fitting our model. We then split the data into testing and training sets:

```{r, warning=FALSE}
library(mgcv)

week_data <- week_count %>% filter(Year <= 2019)

week_train <- week_count %>% filter(Year <2019) 
week_test <- week_count %>% filter(Year == 2019)

model_week <- gam(Count ~ s(Week, bs = "cc") + Year, data = week_train, family = "poisson")

week_train <- week_train %>% cbind("Predicted" = model_week$fitted.values, "Data" = "Train")

week_test <- week_test %>% cbind("Predicted" = as.numeric(predict(model_week, week_test)), "Data" = "Test")



week_dat <- rbind(week_train, week_test)


p <-ggplot(data = week_dat) +
  geom_point(aes(x = `Week Start` , y = Count), color = "steelblue3", alpha =0.5) +
  geom_line(aes(x = `Week Start`, y = Predicted)) 
p
```





